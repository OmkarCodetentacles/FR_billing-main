@model IEnumerable<DtDc_Billing.Entity_FR.Invoice>

@{
    /**/

    ViewBag.Title = "ViewInvoice";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}


<style>
    .Viewsingleinvoice th {
        width: 7.14% !important
    }
</style>
<!-- Main content -->

<div class="content-wrapper">
    <div class="box box-info" style="padding: 16px 16px !important">
        <div class="box-header with-border">
            <h4>
                VIEW SINGLE INVOICE
                <a href="https://www.youtube.com/watch?v=_5jj1ozy0I0&list=PLT-Gd9X3Y1afr1FZRb8Z8ELFncnWwOhzz&index=27"
                   target="_blank"
                   data-toggle="tooltip"
                   title="Click to view more info">
                    <i class="fa fa-info-circle" style="font-size:25px;"></i>
                </a>
            </h4>

        </div>
        <!-- /.box-header -->
        <div class="box-body">

            <div class="row">
                @{
                    var successMessage = @TempData["success"] as string;
                    var errorMessage = TempData["error"] as string;
                }

                @if (!string.IsNullOrEmpty(successMessage))
                {
                    @Html.Partial("~/Views/Shared/AlertPartial.cshtml", new Tuple<string, string>("success", successMessage))
                }
                @if (!string.IsNullOrEmpty(errorMessage))
                {
                    @Html.Partial("~/Views/Shared/AlertPartial.cshtml", new Tuple<string, string>("danger", successMessage))

                }
                    @using (Html.BeginForm("ViewInvoice", "Invoice", FormMethod.Get))
                    {

                        <div class="col-md-3" style="margin-top:10px;padding-left:0">

                            <label>Company Name</label>

                            <input type="text" name="Companydetails" id="Companydetails" class="form-control" value="@ViewBag.Companydetails">

                            @*@Html.DropDownList("Companydetails", "-Please select-")*@

                        </div>
                        <div class="col-md-3" style="margin-top:10px;padding-left:0">

                            <label>Invoice Number</label>

                            <input type="text" name="invoiceNo" id="invoiceNo" class="form-control" value="@ViewBag.invoiceno">

                            @*@Html.DropDownList("Companydetails", "-Please select-")*@

                        </div>

                        <div class="col-md-2" style="margin-top: 10px; padding-left: 0">
                            <label>From Date</label>
                            @*<label class="Reqired">*</label>*@
                            <input type="text" name="invfromdate" id="invfromdate" class="form-control" value="@ViewBag.invfromdate">
                        </div>


                        <div class="col-md-2" style="margin-top: 10px; padding-left: 0">
                            <label>To Date</label>
                            @*<label class="Reqired">*</label>*@
                            <input type="text" name="invtodate" id="invtodate" class="form-control" value="@ViewBag.invtodate">
                        </div>

                        <input type="hidden" value="@ViewBag.firmid">
                        <input type="hidden" value="@ViewBag.Companyid">

                        @*  @Html.HiddenFor(m => m.Firm_Id, new { @Value = ViewBag.firmid })*@

                        <div class="col-md-1" style="padding:0">
                            <input type="submit" class="btn btn-primary sbmt" name="submit" id="submitbook" value="Submit" style="margin:33px auto;width:100%" />
                        </div>

                        <br /><br /><br /><br />
                    
                }
                <div class="col-xs-12">

                    @*<div class="col-md-4">
                            <label for="departmentsDropdown">Firm Name</label>
                            <select class="form-control" id="departmentsDropdown" name="departmentsDropdown"></select>
                        </div>*@
                    <table id="table_display_block" class="table Viewsingleinvoice">
                        <thead>
                            <tr>
                                <th></th>
                                <th></th>
                                <th>
                                    @Html.DisplayNameFor(model => model.invoiceno)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.invoicedate)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.Customer_Id)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.periodfrom)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.periodto)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.total)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.fullsurchargetax)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.fullsurchargetaxtotal)
                                </th>
                                <th>
                                    GST
                                </th>
                                <th>
                                    GST Amount
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.othercharge)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.netamount)
                                </th>


                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td style="display:flex; gap:2px;">
                                        @*@Html.ActionLink("View", "ReportsinglePrinterMethod", new { myParameter = item.invoiceno }) |*@
                                        <a class="view-btn" href="@Url.Action("Download","Invoice",new {id = item.IN_Id })" target="_blank">View</a>
                                        @Html.ActionLink("Edit", "GenerateInvoiceSingle", new { Invoiceno = item.invoiceno, Firm_Id = item.Firm_Id }, new { @class = "edit-btn" })
                                    </td>
                                    <td>
                                        @Html.ActionLink("Delete", "ViewSingleInvoice", "Invoice", new { invoiceNo = item.invoiceno, invfromdate = ViewBag.invfromdate, Companydetails = ViewBag.Companydetails, invtodate = ViewBag.invtodate, isDelete = true }, new { onclick = "return confirm('Do you really want to delete this invoice?')", @class = "delete-btn" })
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.invoiceno)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.tempInvoicedate)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Customer_Id)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.Tempdatefrom)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.TempdateTo)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.total)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.fullsurchargetax)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.fullsurchargetaxtotal)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.servicetax)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.servicetaxtotal)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.othercharge)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.netamount)
                                    </td>


                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->
        </div>
        <!-- /.col -->
    </div>
    <!-- /.row -->
    <!-- /.content -->
</div>

<script>
    $('#invfromdate').datepicker({
        autoclose: true,
        format: 'dd-mm-yyyy'
    })

    $('#invtodate').datepicker({
        autoclose: true,
        format: 'dd-mm-yyyy'
    })

    $(function () {

        $('#table_display_block').dataTable({
            "bPaginate": true,
            "bLengthChange": true,
            "bFilter": true,
            "bSort": true,
            "bInfo": true,
            "bAutoWidth": false
        });


    });
</script>


<script>
    var availableinvoicesarr = [];
    var availableTutorials = [];
    var company_idarr = [];
/////Sender Autocomplete
$(function () {


    $.ajax({
        type: 'GET',
                url: '@Url.Action("CustomerIdAutocompleteForViewInvocie")',
        data: { },
        dataType: 'json',
        success: function(data) {
            $.each(data, function(i, item) {
                        company_idarr.push(item.Company_Id);
            });
                }
            });

    $("#Companydetails").autocomplete({
        source: company_idarr,
select: function(event, ui) {
    $("#Companydetails").val(ui.item.value);

    $("#Companydetails").trigger("focusout");
        }
    });

    //$("#Companydetails").autocomplete({
    //    source: company_idarr,
    //    select: function(event, ui) {

    //    }
    //});
});

    $('#Companydetails').focusout(function () {
        var Customerid = $('#Companydetails').val();
        if (Customerid.length >= 3) {
            $.ajax({
                type: 'Get',
                dataType: 'json',
                url: '/Booking/Checkcompany',
                data: { Customerid: Customerid },
                success: function (Data) {

                    if (Data == "0") {
                        alert("Please Enter Valid Company Id");
                        $('#Companydetails').val('');
                    }



                }
            });
        }
    });


    $(function () {

          $.ajax({
      type: 'GET',
      url: '@Url.Action("InvoiceNumberAutocompleteForViewInvocie")',
              data: { Customer_Id:null},
      dataType: 'json',
              success: function (data) {

          $.each(data, function (i, item) {
              availableinvoicesarr.push(item.invoiceno);
          })
      }
  });
  //      $("#invoiceno").autocomplete({
  //          source: availableinvoicesarr,
  //          select: function (event, ui) {
  //              $("#invoiceno").val(ui.item.value);
  //              $("#invoiceno").trigger("focusout")
  //          }
  //      });
        $("#invoiceno").autocomplete({
            source: availableinvoicesarr,
          select: function (event, ui) {
              $("#invoiceno").val(ui.item.value);

              $("#invoiceno").trigger("focusout");
          }
      });
    })

</script>

<script>

    $('#Companydetails').change(function () {
        var Customerid = $('#Companydetails').val();

        if (Customerid.length >= 3) {
            availableinvoicesarr = [];

            $("#invoiceno").autocomplete({
                source: availableinvoicesarr,
                select: function (event, ui) {
                    $("#invoiceno").val(ui.item.value);

                    $("#invoiceno").trigger("focusout");
                }
            });

            $.ajax({
                type: 'Get',
                dataType: 'json',
                url: '/Invoice/InvoiceNumberAutocompleteForViewInvocie',
                data: { Customer_Id: Customerid },
                success: function (Data) {
                    $.each(Data, function (i, item) {
                        availableinvoicesarr.push(item.invoiceno);
                    })

                }
            });
        }
        $("#invoiceno").autocomplete({
            source: availableinvoicesarr,
            select: function (event, ui) {
                $("#invoiceno").val(ui.item.value);

                $("#invoiceno").trigger("focusout");
            }
        });


    });
    $("#invoiceno").focusout(function () {
        availableinvoicesarr = [];
        $("#invoiceno").autocomplete({
            source: availableinvoicesarr,
            select: function (event, ui) {
                $("#invoiceno").val(ui.item.value);

                $("#invoiceno").trigger("focusout");
            }
        });

    });

</script>
@*<script>
    var a =@Request.Params["Firm_Id"];

    $(document).ready(function () {
        $.ajax({
            type: "GET",
            url: "/Invoice/getFirm",
            data: "{}",
            success: function (data) {
                // var s = '<option value="-1">Please Select a Department</option>';
                var s;
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].Firm_Id + '">' + data[i].Firm_Name + '</option>';
                }
                $("#departmentsDropdown").html(s);

                $("#departmentsDropdown").val(a);


            }



        });
    });


    </script>

    <script>
        $("#departmentsDropdown").change(function () {
            //var selectedStudentVal = $("#ddlStudent").val();
            //window.location.replace("/Invoice/GenerateInvoice?Firm_Id=" + selectedStudentVal);

            var departmentsDropdown = $("#departmentsDropdown").val();
            // window.history.pushState("null", "null", "/Invoice/GenerateInvoice?Firm_Id=" + departmentsDropdown);
            window.location.replace("/Invoice/ViewSingleInvoice?Firm_Id=" + departmentsDropdown);

            $("#departmentsDropdown").html(departmentsDropdown);
        });




    </script>*@



@*@if (TempData["error"] != null)
    {
        <script>
            //alert('@TempData["error"]');
        </script>
    }



    @if (TempData["success"] != null)
    {
        <script>
            //alert('@TempData["success"]');
        </script>
    }*@