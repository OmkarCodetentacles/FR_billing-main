
@model DtDc_Billing.Models.LoginVerification
@{
    Layout = null;
}
<style>
    #timer {
        font-size: 30px;
        color: green;
        font-style: normal;
        margin: auto;
        text-align: center;
    }

     .container {
        height: 600px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .card {
        width: 450px;
        border: 2px solid #eee; /* Default border */
        border-radius: 10px;
    }

    @@media (max-width: 567px) {
        /* Apply a different border for smaller screens */
        .card {
            border: 1px solid #eee;
        }
    }
  

    .alert-danger {
        background: red !important;
        color: white !important;
    }

    .alert-warning {
        background: #ffc107 !important;
        margin-bottom: 0;
        color:black !important;
    
    }


    .btn-responsive {
        margin-right: 3rem;
        display: block;
        width: 100%;
        margin-bottom: 15px;
        border-radius: 5px;
        padding: 10px;
        margin: 5px;
        font-size: 16px;
        font-weight: bold;
        text-align: center;
        cursor: pointer;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        width: 150px;
        height: 40px;
    }

    .btn:hover {
        background-color: #0094ff;
    }

    #messageContainer {
        margin-top:10px;
        padding:10px;

        /*border:1px solid red;*/
        font-weight:bold;
        font-family:Arial;
    }
    @@media (min-width: 376px) {
        .btn-responsive {
        display: inline-block;
        width: auto;
        margin-bottom: 0;
    }
}
</style>
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>VerifyEmail</title>
    <link rel="shortcut icon" href="~/assets/images/fav.png">
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/fontawesome.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="~/admin-lte/plugins/fastclick/fastclick.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

 

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" integrity="sha384-T1xn5ZHu2hIAAHO29KF8mND1sFq9auFb0LpZVw5RYYFQV5kxFKaAewtBKaDAKlzy" crossorigin="anonymous">
    

    <script>
        $(document).ready(function () {
            $("#timer").hide();    
            $("#resendbtn").hide();
          
            ShowHideButton();
         
                   
                   




        var errorMessage = @Html.Raw(Json.Encode(TempData["ErrorMessage"]));
        var invalidOTP = @Html.Raw(Json.Encode(TempData["invalidOTP"]));
        var timeExpired = @Html.Raw(Json.Encode(TempData["timeexpired"]));

            if (errorMessage != null || invalidOTP != null || timeExpired) {

                $("#submitBtn").prop("disabled", false);
                $("#verifyBtn").hide(); // Add # symbol for the ID selector

                $("#resendbtn").show();
            } else {

                $("#resendbtn").hide();
            }
           
        });
    </script>

</head>
<body>
   

    <!--Login Model-->
    <!--Login Model-->
    <form action="/Admin/VerifyLogin" method="post">
        @Html.AntiForgeryToken()
        <div class="container" style=" margin-top:70px; height:500px; display: flex; align-items: center; justify-content: center;">
            <!-- Added styles for vertical and horizontal centering -->
          
                <div class="card" style="width:500px;">
                    <div class="box-body">
                        <div class="card-header text-center">
                            <h5 class="card-title mt-3" style="font-family: 'Arial',sans-serif; font-size:24px; font-weight: bold;">*Login Verification*</h5>
                            <div id="messageContainer" class="alert alert-info" style="display:none;"></div>
                            @if (TempData["ErrorMessage"] != null)
                            {
                                <script>

                                    $("#timer").hide();
                                
                                 var errorMessage = '@Html.Raw(TempData["ErrorMessage"])';
                                 showErrorAlert(errorMessage);
                                 function showErrorAlert(message) {

             
                                     $("#messageContainer").text(message).removeClass("alert-success alert-warning alert-info").addClass("alert-danger").show();
                                     setTimeout(function () {
                                         $("#messageContainer").hide();
                                     }, 10000);

                                 }
                                </script>
                            }
                            @if (TempData["invalidOTP"] != null)
                            {
                                <script>

                           $("#timer").hide();                     
                         $("#resendbtn").show();
                         var invalidOtpMessage = '@Html.Raw(TempData["invalidOTP"])';
                             showErrorAlert(invalidOtpMessage);
                             function showErrorAlert(message) {
                                 console.log(message)

                                 $("#messageContainer").text(message).removeClass("alert-success alert-warning alert-info").addClass("alert-danger").show();
                                 setTimeout(function () {
                                     $("#messageContainer").hide();
                                 }, 10000);
                                 }
                                </script>

                            }
                            @if (TempData["timeexpired"] != null)
                            {
                                <script>


                                    $("#timer").hide();
                         var expiredMessage = '@Html.Raw(TempData["timeexpired"])';
                             showWarningAlert(expiredMessage);
                             function showWarningAlert(message) {
                                 console.log(message)

                                 $("#messageContainer").text(message).removeClass("alert-success alert-danger alert-info").addClass("alert-warning").show();
                                 setTimeout(function () {
                                     $("#messageContainer").hide();
                                 }, 10000);
                             }
                                </script>

                            }
                            @if (TempData["otpSentMessage"] != null)
                            {
                                <script>
                                    $("#timer").show();    
                                    var message = '@Html.Raw(TempData["otpSentMessage"])';
                                    showSuccessAlert(message);
                                    function showSuccessAlert(message) {
                                        console.log(message)

                                        $("#messageContainer").text(message).removeClass("alert-info alert-danger alert-warning").addClass("alert-success").show();
                                        setTimeout(function () {
                                            $("#messageContainer").hide();
                                        }, 10000);

                                    }
                                </script>
                            }
                            <img src="~/assets/images/Original.gif" alt="Your Logo" class="img-fluid" style="max-height:300px; max-width:600px;" />
                        </div>

                            <div class="card-body text-center">
                                <div id="timer" style="margin-bottom:15px"></div>
                                @*<div class="alert alert-info" style="" id="otpSentMessage">
                                    OTP has been sent to your mobile. Please check it.
                                </div>*@
                                <div class="mb-3">
                                    @*<button type="button" class="btn btn-info btn-lg btn-responsive" id="verifyBtn">Verify</button>*@
                                    <button type="button" class="btn btn-warning btn-lg btn-responsive" id="resendbtn">Resend</button>
                                </div>
                                <br/>
                                <div class="mb-3">
                                    @Html.HiddenFor(model => model.mobileNo, new { @class = "form-control input-sm" })
                                </div>
                                <div class="mb-3">
                                    @Html.HiddenFor(model => model.PF_Code, new { @class = "form-control input-sm" })
                                </div>
                                <div class="form-group">
                                    @Html.LabelFor(model => model.LoginOTP, htmlAttributes: new { @class = "col-md-4 control-label", @style = "color: #007bff; font-weight: bold;font-size:20px" })
                                    @Html.HiddenFor(model => model.LoginOTP)

                                    <div class="mb-4">
                                        <div class="otp-inputs">
                                            @for (int i = 1; i <= 6; i++)
                                            {
                                                <input type="text" id="@i" class="form-control input-lg otp-char mx-1" maxlength="1" data-index="@i" style="width: 46px; display: inline-block;" />
                                            }
                                        </div>
                                        @*@class = "form-control input-lg", @placeholder="******"*@

                                        @Html.ValidationMessageFor(model => model.LoginOTP, "", new { @class = "text-danger" })
                                    </div>
                                </div>






                            </div>
                         
                            <div class="card-footer text-center align-content-end">
                                <input type="submit" value="Submit" class="btn btn-info btn-lg btn-responsive mr-2" id="submitBtn" />
                                <button type="button" class="btn btn-danger btn-lg btn-responsive" id="closeModalBtn">Close</button>
                            </div>
                        </div>
                </div>
      
        </div>
    </form>

    <script>
      
        $(".otp-char").on("input", function () {
            var index = $(this).data("index");
            var otpInputs = $(".otp-char");


            // Collect the password from all input fields
            var otp = "";
            otpInputs.each(function () {
                otp += $(this).val();
            });
            if (index < otpInputs.length && $(this).val().trim() !== "") {
                otpInputs.eq(index).focus();
            }
            // Set the collected password to a hidden field or perform any other action
            if (otp.length == 6) {
            
                $("#LoginOTP").val(otp);
            }
          
        });
    </script>
    <script>
       
            var countdownTime = 2 * 60; // 3 minutes
            var timerInterval;

            function updateTimer() {

                var minutes = Math.floor(countdownTime / 60);
                var seconds = countdownTime % 60;

                // Display the timer in the "timer" div
                document.getElementById('timer').innerHTML = minutes + 'm ' + seconds + 's';

                // Check if the countdown is over
                if (countdownTime === 0) {
                    clearInterval(timerInterval);

                    ShowReset();

                    var errorMessage = "Your Time is Expired!";
                    $("#messageContainer").text("Your Time is Expired Resend Again!!").removeClass("alert-success alert-danger alert-info").addClass("alert-warning").show();


                    TimeOut();

                }
                else {
                    countdownTime--;
                }
            }

            function ShowReset() {
                $("#resendbtn").show();
            }
            function ResetShowHideButton() {
                $("#submitBtn").prop("disabled", false);
              

                $("#timer").show();
                timerInterval = setInterval(updateTimer, 1000);

            }
            function ShowHideButton(){
               
                $("#submitBtn").prop("disabled", false);
               // $("#verifyBtn").hide(); // Add # symbol for the ID selector

                $("#timer").show();
                timerInterval = setInterval(updateTimer, 1000);
            }
            function TimeOut() {
                setTimeout(function () {
                    $("#messageContainer").hide();
                }, 10000);
            }
            function resetTimer() {
                clearInterval(timerInterval);
                startCountdown();
            }
            function startCountdown() {

                countdownTime = 120; // Set the initial countdown time in seconds
                timerInterval = setInterval(updateTimer, 1000);
            }
        $(document).on('click', '#verifyBtn', function () {


                 var mobileNo = $("input[name='mobileNo']").val();

            var pfcode = $("input[name='PF_Code']").val();

            $.ajax({
                url: '@Url.Action("SendLoginOTPtoM", "Admin")',
                type: 'POST',
                data: { mobileNo: mobileNo, pfcode:pfcode },
                success: function (result)
                {

                    if (result.success) {

                        $("#messageContainer").text("OTP sent on your Mobile Number successfully!").removeClass("alert-danger alert-warning alert-info").addClass("alert-success").show();
                        ShowHideButton();
                        TimeOut();


                    } else {
                        // Show the error message
                        $("#messageContainer").text("Failed to sent OTP. Please try again!").removeClass("alert-success alert-warning alert-info").addClass("alert-danger").show();
                        TimeOut();

                    }

                },
                error: function (result) {
                    $("#messageContainer").text("Something went wrong. Please try again!").removeClass("alert-success alert-warning alert-info").addClass("alert-danger").show();
                    TimeOut();
                }
            });
        });

    </script>
    <script>
   $(document).on('click', '#resendbtn', function () {


    var mobileNo = $("input[name='mobileNo']").val();

   var pfcode = $("input[name='PF_Code']").val();

    $.ajax({
        url: '@Url.Action("SendLoginOTPtoM", "Admin")',
        type: 'POST',
        data: { mobileNo: mobileNo, pfcode: pfcode },
        success: function (result)
        {

            if (result.success) {
                resetTimer();
                $("#messageContainer").text("OTP Resent on your Mobile Number successfully!").removeClass("alert-danger").addClass("alert-success").show();

                ResetShowHideButton();
                TimeOut();


            } else {
                // Show the error message
                $("#messageContainer").text("Failed to sent OTP. Please try again!").removeClass("alert-success").addClass("alert-danger").show();
                TimeOut();

            }

        },
        error: function (result) {
            $("#messageContainer").text("Something went wrong. Please try again!").removeClass("alert-success").addClass("alert-danger").show();
            TimeOut();
        }
    });
});

    </script>
    <script>

        $(document).ready(function () {
           
                    
            
            $("#closeModalBtn").click(function () {
           
                window.location.href = '/Admin/AdminLogin/';
            });

        })
    </script>
</body>
</html>

