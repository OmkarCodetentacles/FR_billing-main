@model string
@{
    ViewBag.Title = "GetConsignmentInfo";
    Layout = "~/Views/Shared/AdminLayout.cshtml";

}
<!-- jQuery 3.x -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    .table {
        width: 100%;
        border-collapse: collapse; /* Optional: To collapse table borders */
    }
    .widget {
        margin: 0 auto;
        width: 100% !important;
        overflow: hidden !important;
    }
   
    table {
        width: 100%;
        max-height:2000px !important;
        border:0px !important;
    }
    #linkId {
        display:none;
    }

    .fftxt{
        display:none;
    }
    .fa fa-instagram icon{
        display:none;
    }
    .icon-small icon-print{
        display:none;   
    }
    #consignmentdetails table td {
        border: 0px !important;
    }
    table#consignmentTable {
        max-height: 500px !important;
    }

   /* table, th, td {
        border: 1px solid black;
    }
*/
    th, td {
        padding: 10px;
        text-align: left;
    }

    #viewDRSImage, #podImgLink, #viewPOD, #viewSignature, #linkId, #viewImage, #mailIDput {
        display: none;
    }

    .main-footer {
        display: none;
    }

/*    img {
        display: none;
    }*/
  /*  #consignmentdetails {
        overflow: hidden;
    }*/
    /*table#consignmentTable {
        max-height: none !important;*/ /* Remove the max-height property */
    /*}*/
    .bordered-cell {
        border: 1px solid black; /* Set your desired border style */
        padding: 5px; /* Optional: Set padding for cells */
    }
    .widget-header_new {
        background: #808080 repeat scroll 0 0 !important;
        border-top: 4px solid #dde2e6 !important;
    }

    .h3 {
        background-color: gray;
        color: blueviolet;
    }

    /* .white_style{
            display:none
        }*/
</style>
<script>
    $(document).ready(function () {
        $("#consignmentdetails").show();
    })
</script>
<br/><br/>
<section class="content-wrapper" sstyle="margin-left:20px">
    @*<div class="">
        <div class="row">
            <div class="col-md-12 ">
            

                    <div class="">*@
                        @*<div class="row">*@
                            <div class="box box-info" style="background: none; background: white; padding: 15px; height:100%">
                                <div class="box-header with-border">
                                    <h4> Tracking Information of Consignment</h4>
                                </div><!-- /.box-header -->
                                <div class="form-horizontal">
                                    <div class="row">
                                        <div class="col-md-12">


                                            <div class="box-body">
                                                <div class="form-group">
                                                    <label class="col-md-3 control-label">Enter Consignment Number<br /></label>
                                                    <div class="col-md-12">
                                                        <div class="row">
                                                            @using (Html.BeginForm())
                                                            {
                                                                <div class="col-md-6">


                                                                    @if (ViewBag.Consignmentno == null)
                                                                    {
                                                                        <input type="text" name="consignmetno" id="consignmetno" class="form-control" required />

                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="text" name="consignmetno" id="consignmetno" class="form-control" value="@ViewBag.Consignmentno" required />

                                                                    }

                                                                </div>
                                                                <div class="col-md-6">
                                                                    <input type="submit" value="View" class="btn btn-primary" />
                                                                </div>
                                                            }


                                                            @if (Model != null)
                                                            {
                                                                <br /><br />
                                                                <div class="pull-left" id="consignmentdetails" style="padding-top:50px;">
                                                                    @*padding-right:140px*@

                                                                    <div class="col-md-12">
                                                                        @Html.Raw(Model)

                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <input type="button" class="btn btn-info" @*id="showalldetails"*@ onclick="GetConsignmentDetails()" value="View All Details" />
                                                                    </div>
                                                                </div>


                                                                <table id="consignmentTable">
                                                                    <thead>
                                                                        <tr id="tableHeaders">
                                                                            <th>Sr No</th>
                                                                            <th>Date</th>
                                                                            <th>Delivery Status</th>
                                                                            <th>Activity Type</th>
                                                                            @*<th>From</th>*@
                                                                            <th>Origin</th>
                                                                            <th>To</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody id="consdata">
                                                                    </tbody>
                                                                    <tbody>
                                                                        <!-- Table body will be populated dynamically -->
                                                                    </tbody>
                                                                </table>

                                                            }


                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            @*<div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <input type="submit" value="Save" class="btn btn-primary" />
                        </div>
                    </div>*@

                                        </div>
                                    </div>
                                </div>
                            </div>

                        @*</div>

                    </div>*@


                
               
                <script>
                    var form = $('#frmEmp');
                    // Submit the form
                    form.submit();

                </script>


                @*@Html.Partial("GetConsignmentDetails", Model)*@

            @*</div>
        </div>
        </div>*@
</section>


<script>

    $(document).ready(function () {
        var consbody = '@ViewBag.Consignmentno';
        $("#@ViewBag.Consignmentno").show();
        $("#@ViewBag.Consignmentno_displayBar").show();
    })
    function removeDuplicateScriptsAndStyles() {
        // Create arrays to store unique script and link sources
        var scriptSources = [];
        var linkSources = [];

        // Iterate through all script elements
        var scriptElements = document.getElementsByTagName('script');
        for (var i = 0; i < scriptElements.length; i++) {
            var src = scriptElements[i].getAttribute('src');
            if (src && scriptSources.indexOf(src) === -1) {
                // Script source is unique
                scriptSources.push(src);
            } else {
                // Duplicate script found, remove it
                  var consignmentno = '@ViewBag.Consignmentno';
                console.log("Duplicate ===removeDuplicateScriptsAndStyles==consignmentno==" + consignmentno);
                scriptElements[i].parentNode.removeChild(scriptElements[i]);
            }
        }

        // Iterate through all link elements
        var linkElements = document.getElementsByTagName('link');
        for (var j = 0; j < linkElements.length; j++) {
            var href = linkElements[j].getAttribute('href');
            if (href && linkSources.indexOf(href) === -1) {
                // Link source is unique
                linkSources.push(href);
            } else {
                // Duplicate link found, remove it
                linkElements[j].parentNode.removeChild(linkElements[j]);
            }
        }
    }
    document.addEventListener("DOMContentLoaded", function () {
        $("#consignmentTable").hide();
        removeDuplicateScriptsAndStyles();

        changeStylesOnLoad();
        var jsessionIdExists = $("#deliveryImage[src*='jsessionid']").length > 0;

        if (jsessionIdExists) {
            $("#deliveryImage").hide();
        }
        //$("#podImgLink").hide();
        //$("#viewPOD").hide();
        //$("#viewSignature").hide();
        //$("#viewImage").hide();
        //$("#linkId").hide();

    });

    function changeStylesOnLoad() {

        var widgetHeader = document.querySelector('.widget-header_new');
        var white_style = document.querySelector('.white_style');
        var colMd12Elements = document.querySelector('.main-inner');
        var colmain = document.querySelector('.main');
        var topValignTds = document.querySelectorAll('td[valign="top"]');

        //topValignTds.forEach(function (td) {
        //    td.style.textAlign = "center"; // You can set other values like "left", "right", or "justify"
        //});
        topValignTds.forEach(function (td) {
            td.style.textAlign = "center"; // You can set other values like "left", "right", or "justify"
            td.style.width = "1000px"; // Set the desired width here
        });

        if (widgetHeader) {

            widgetHeader.style.background = '#808080 none repeat scroll 0 0 !important';
            widgetHeader.style.borderTop = '0px solid #dde2e6 !important';


        }
        // Hide image if "Successfully Delivered" text is present
        var deliveredText = "Successfully Delivered";
        var consignmentDetailsText = $("#consignmentdetails").text();

        if (consignmentDetailsText.includes(deliveredText)) {
            $("#deliveryImage").hide();
        }
    }

</script>
<script>
    var jsonData = [];
        function GetConsignmentDetails() {
            var consignmentno = '@ViewBag.Consignmentno';
            if (consignmentno != null) {
                console.log("consignmentno==" + consignmentno);

                jQuery.noConflict();

                // Use jQuery instead of $
                jQuery.ajax({
                    type: 'post',
                    dataType: 'json',
                    url: '/Admin/GetConsignmentInfoInDeatils',
                    data: { ConsignmnetNo: consignmentno },
                    success: function (data) {
                        // Handle the success response


                        console.log(data);
                        jsonData = data;
                        renderTable();
                    },
                    error: function (xhr, status, error) {
                        alert(error)
                    }
                });
            } else {
                alert("Enter Consingment Number!!")
            }
          
    }

    function renderTable() {
        var tableBody = $("#consignmentTable tbody");
      //  $("#consignmentTable tbody").empty();

        var parsedData = JSON.parse(jsonData);
        console.log(parsedData)
        var tableBody = document.getElementById('consdata');
        console.log(parsedData)
        //var rows='';

        //parsedData.forEach(function (item, i) {

        //    rows += "<tr>"
        //        + "<td>" + (i + 1) + "</td>"
        //        + "<td>" + item.date + "</td>"
        //        + "<td>" + item.deliveryStatus + "</td>"
        //        + "<td>" + item.activityType + "</td>"
        //       // + "<td>" + (item.from ? item.from : '') + "</td>"
        //        + "<td>" + (item.origin ? item.origin : '') + "</td>"


        //        + "</tr>";

        //});
        tableBody.innerHTML = '';

        parsedData.forEach(function (item, i) {
            var row = tableBody.insertRow(i);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var cell6 = row.insertCell(5);
            // Add a CSS class to set the border style
         
            // Set height and width for the cells
            var cellHeight = "30px"; // Set your desired height
            var cellWidth = "200px"; // Set your desired width

            cell1.style.height = cellHeight;
            cell1.style.width = cellWidth;

            cell2.style.height = cellHeight;
            cell2.style.width = cellWidth;

            cell3.style.height = cellHeight;
            cell3.style.width = cellWidth;

            cell4.style.height = cellHeight;
            cell4.style.width = cellWidth;

            cell5.style.height = cellHeight;
            cell5.style.width = cellWidth;

            cell6.style.height = cellHeight;
            cell6.style.width = cellWidth;

            cell1.innerHTML = i + 1;
            cell2.innerHTML = item.date;
            cell3.innerHTML = item.deliveryStatus;
            cell4.innerHTML = item.activityType;
            cell5.innerHTML = item.origin;
            cell6.innerHTML = item.dest;
        });



        //alert(rows)
        //console.log("Append Row===" + rows)
        //tableBody.append(rows);
        //$.each(parsedData, function (i, item) {
        //    debugger;
        //    rows += "<tr>"
        //        + "<td>" + (i + 1) + "</td>"
        //        + "<td>" + item.date + "</td>"
        //        + "<td>" + item.activityType + "</td>"
        //        + "<td>" + item.deliveryStatus + "</td>"
        //        + "</tr>";
        //});

        // Append rows to the table body

    }

    renderTable();
</script>


@*<script>
    $(document).ready(function () {
        renderTable();
    });
    </script>*@
