@model IEnumerable<DtDc_Billing.Entity_FR.GSTInvoice>

@{
    /**/

    ViewBag.Title = "ViewInvoiceWithoutGST";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}



<link href="~/admin-lte/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" rel="stylesheet" />
<script src="~/admin-lte/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>

<style>
    .Viewsingleinvoice th {
        width: 7.14% !important
    }
</style>
<!-- Main content -->

<div class="content-wrapper">
    <div class="box box-info" style="padding: 16px 16px !important">
        <div class="box-header with-border">
            <h4>
                View Invoice Without GST
                <a href="https://www.youtube.com/watch?v=_5jj1ozy0I0&list=PLT-Gd9X3Y1afr1FZRb8Z8ELFncnWwOhzz&index=27"
                   target="_blank"
                   data-toggle="tooltip"
                   title="Click to view more info">
                    <i class="fa fa-info-circle" style="font-size:25px;"></i>
                </a>
            </h4>

        </div>
        <!-- /.box-header -->
        <div class="box-body">

            <div class="row">
                @{
                    var successMessage = @TempData["success"] as string;
                    var errorMessage = TempData["error"] as string;
                }

                @if (!string.IsNullOrEmpty(successMessage))
                {
                    @Html.Partial("~/Views/Shared/AlertPartial.cshtml", new Tuple<string, string>("success", successMessage))
                }
                @if (!string.IsNullOrEmpty(errorMessage))
                {
                    @Html.Partial("~/Views/Shared/AlertPartial.cshtml", new Tuple<string, string>("danger", successMessage))

                }
                @using (Html.BeginForm("ViewInvoiceWithoutGST", "Invoice", FormMethod.Get, new {id= "FormSubmitSingle" }))
                {


                    if (ViewBag.Companydetails != null)
                    {
                        <div class="col-md-3" style="margin-top:10px;padding-left:0">

                            <label>Company Name</label>

                            <input type="text" name="Companydetails" id="Companydetails" class="form-control" value="@ViewBag.Companydetails">

                            @*@Html.DropDownList("Companydetails", "-Please select-")*@

                        </div>
                    }
                    else
                    {
                        <div class="col-md-3" style="margin-top:10px;padding-left:0">

                            <label>Company Name</label>

                            <input type="text" name="Companydetails" id="Companydetails" class="form-control">

                            @*@Html.DropDownList("Companydetails", "-Please select-")*@

                        </div>
                    }
                  
                    if (ViewBag.fromdate != null)
                    {
                        <div class="col-md-2" style="margin-top: 10px; padding-left: 0">
                            <label>From Date</label>
                            @*<label class="Reqired">*</label>*@
                            <input type="text" name="invfromdate" id="invfromdate" class="form-control" value="@ViewBag.fromdate">
                        </div>
                    }
                    else
                    {
                        <div class="col-md-2" style="margin-top: 10px; padding-left: 0">
                            <label>From Date</label>
                            @*<label class="Reqired">*</label>*@
                            <input type="text" name="invfromdate" id="invfromdate" class="form-control">
                        </div>
                    }
                    if (ViewBag.todate != null)
                    {
                        <div class="col-md-2" style="margin-top: 10px; padding-left: 0">
                            <label>To Date</label>
                            @*<label class="Reqired">*</label>*@
                            <input type="text" name="invtodate" id="invtodate" class="form-control" value="@ViewBag.todate">
                        </div>
                    }
                    else
                    {
                        <div class="col-md-2" style="margin-top: 10px; padding-left: 0">
                            <label>To Date</label>
                            @*<label class="Reqired">*</label>*@
                            <input type="text" name="invtodate" id="invtodate" class="form-control">
                        </div>
                    }




                    <input type="hidden" value="@ViewBag.firmid">
                    <input type="hidden" value="@ViewBag.Companyid">

                    @*  @Html.HiddenFor(m => m.Firm_Id, new { @Value = ViewBag.firmid })*@

                    <div class="col-md-1" style="padding:0">
                        <input type="submit" class="btn btn-primary sbmt" name="submit" id="submitbook" value="Submit" style="margin:33px auto;width:100%" />
                    </div>

                    <br /><br /><br /><br />

                }
                <div class="col-xs-12">

                  
                    <table id="table_display_block" class="table Viewsingleinvoice">
                        <thead>
                            <tr>
                                <th></th>
                               
                                <th>
                                    Invoice Date
                                </th>
                                <th>
                                    Customer Id
                                </th>

                                <th>
                                    Period From
                                </th>
                                <th>
                                    Period To
                                </th>
                                <th>
                                    Total
                                </th>
                                <th>
                                    Fuel Surcharge(%)
                                </th>
                                <th>
                                    Fuel Surcharge Total
                                </th>
                                <th>
                                    Discount(%)
                                </th>
                                <th>Discount Amount</th>
                                <th>
                                    GST(%)
                                </th>
                                <th>
                                    GST Amount
                                </th>
                                <th>
                                    Other Charge
                                </th>
                                <th>
                                    Net Amount
                                </th>


                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td style="display:flex; gap:2px;">
                                      
                                        <a class="view-btn" href="@Url.Action("DownloadGSTInvoice","Invoice",new {id = item.IN_Id })" target="_blank">View</a>
                                        @Html.ActionLink("Edit", "GenerateInvoiceWithoutGST", new { InvoiceID = item.IN_Id }, new { @class = "edit-btn" })
                                   
                                        @Html.ActionLink("Delete", "ViewInvoiceWithoutGST", "Invoice", new
                                        {
                                            invoiceNo = item.invoiceno,
                                            invfromdate = ViewBag.invfromdate,
                                            Companydetails = ViewBag.Companydetails,
                                            invtodate = ViewBag.invtodate,
                                            isDelete = true,
                                            InvoiceId = item.IN_Id
                                        }, new
                                        {
                                            onclick = "return confirm('Are you sure you want to delete this invoice? This action is permanent, and the invoice will be permanently deleted.')",
                                            @class = "delete-btn"
                                        })
                                    </td>
                                  
                                    <td>
                                        @Html.DisplayFor(modelItem => item.tempInvoicedate)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Customer_Id)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.Tempdatefrom)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.TempdateTo)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.total)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.fullsurchargetax)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.fullsurchargetaxtotal)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.discountper)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem =>item.discountamount)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.servicetax)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.servicetaxtotal)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.othercharge)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.netamount)
                                    </td>


                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->
        </div>
        <!-- /.col -->
    </div>
    <!-- /.row -->
    <!-- /.content -->
</div>

<script>
    $('#invfromdate').datepicker({
        autoclose: true,
        format: 'dd-mm-yyyy'
    })

    $('#invtodate').datepicker({
        autoclose: true,
        format: 'dd-mm-yyyy'
    })

    $(function () {

        $('#table_display_block').dataTable({
            "bPaginate": true,
            "bLengthChange": true,
            "bFilter": true,
            "bSort": true,
            "bInfo": true,
            "bAutoWidth": false
        });


    });
</script>


<script>
    var availableinvoicesarr = [];
    var availableTutorials = [];
    var company_idarr = [];
/////Sender Autocomplete
$(function () {


    $.ajax({
        type: 'GET',
                url: '@Url.Action("CustomerIdAutocompleteForViewInvocie")',
        data: { },
        dataType: 'json',
        success: function(data) {
            $.each(data, function(i, item) {
                        company_idarr.push(item.Company_Id);
            });
                }
            });

    $("#Companydetails").autocomplete({
        source: company_idarr,
select: function(event, ui) {
    $("#Companydetails").val(ui.item.value);

    $("#Companydetails").trigger("focusout");
        }
    });

    //$("#Companydetails").autocomplete({
    //    source: company_idarr,
    //    select: function(event, ui) {

    //    }
    //});
});

    $('#Companydetails').focusout(function () {
        var Customerid = $('#Companydetails').val();
        if (Customerid.length >= 3) {
            $.ajax({
                type: 'Get',
                dataType: 'json',
                url: '/Booking/Checkcompany',
                data: { Customerid: Customerid },
                success: function (Data) {

                    if (Data == "0") {
                        alert("Please Enter Valid Company Id");
                        $('#Companydetails').val('');
                    }



                }
            });
        }
    });


    $(function () {

          $.ajax({
      type: 'GET',
      url: '@Url.Action("InvoiceNumberAutocompleteForViewInvocie")',
              data: { Customer_Id:null},
      dataType: 'json',
              success: function (data) {

          $.each(data, function (i, item) {
              availableinvoicesarr.push(item.invoiceno);
          })
      }
  });
  //      $("#invoiceno").autocomplete({
  //          source: availableinvoicesarr,
  //          select: function (event, ui) {
  //              $("#invoiceno").val(ui.item.value);
  //              $("#invoiceno").trigger("focusout")
  //          }
  //      });
        $("#invoiceno").autocomplete({
            source: availableinvoicesarr,
          select: function (event, ui) {
              $("#invoiceno").val(ui.item.value);

              $("#invoiceno").trigger("focusout");
          }
      });
    })

</script>

<script>

    $('#Companydetails').change(function () {
        var Customerid = $('#Companydetails').val();

        if (Customerid.length >= 3) {
            availableinvoicesarr = [];

            $("#invoiceno").autocomplete({
                source: availableinvoicesarr,
                select: function (event, ui) {
                    $("#invoiceno").val(ui.item.value);

                    $("#invoiceno").trigger("focusout");
                }
            });

            $.ajax({
                type: 'Get',
                dataType: 'json',
                url: '/Invoice/InvoiceNumberAutocompleteForViewInvocie',
                data: { Customer_Id: Customerid },
                success: function (Data) {
                    $.each(Data, function (i, item) {
                        availableinvoicesarr.push(item.invoiceno);
                    })

                }
            });
        }
        $("#invoiceno").autocomplete({
            source: availableinvoicesarr,
            select: function (event, ui) {
                $("#invoiceno").val(ui.item.value);

                $("#invoiceno").trigger("focusout");
            }
        });


    });
    $("#invoiceno").focusout(function () {
        availableinvoicesarr = [];
        $("#invoiceno").autocomplete({
            source: availableinvoicesarr,
            select: function (event, ui) {
                $("#invoiceno").val(ui.item.value);

                $("#invoiceno").trigger("focusout");
            }
        });

    });

</script>

<script>
    $(document).ready(function () {
        $('#submitbook').on('click', function (e) {
            // Prevent form submission


            // Get values of the fields
            var companyDetails = $('#Companydetails').val().trim();
            var invoiceNo = $('#invoiceNo').val().trim();
            var invFromDate = $('#invfromdate').val().trim();
            var invToDate = $('#invtodate').val().trim();

            // Check if at least one of the fields is filled
            if (companyDetails === "" && invoiceNo === "" && (invFromDate === "" || invToDate === "")) {
                alert("Please select at least one: Company Name, Invoice Number, or From Date to To Date.");
                e.preventDefault();
                return false; // Stop the form submission
            }

            // If validation passes, submit the form
            $("#FormSubmitSingle").submit();
        });
    });
</script>